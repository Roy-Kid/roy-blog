---
title: 第零章- MPI简介
date: 2021-05-30
categories:
 - HPC
tags:
 - MPI
sidebar: 'auto'
---

> 本教程搬运自都志辉老师的《高性能计算之并行编程技术--MPI并行程序设计》. 我在学习的过程中增加了python实现和一些问题的注释. 

## 什么是MPI

对MPI的定义是多种多样的, 但不外乎下面三个方面, 它们限定了MPI的内涵和外延

1. MPI是一个库, 而不是一门语言, 许多人认为MPI就是一种并行语言, 这是不准确的
但是按照并行语言的分类. 可以把`FORTRAN+MPI`或`C+MPI`, 看作是一种在原来串行语言基
础之上扩展后得到的并行语言, MPI库可以被`FORTRAN77`/`C`/`Fortran90`/`C++`调用, 从语法上
说, 它遵守所有对库函数/过程的调用规则, 和一般的函数/过程没有什么区别;
2. MPI是一种标准或规范的代表, 而不特指某一个对它的具体实现, 迄今为止, 所有的
并行计算机制造商都提供对MPI的支持, 可以在网上免费得到MPI在不同并行计算机上的实
现. 一个正确的MPI程序, 可以不加修改地在所有的并行机上运行;
3. MPI是一种消息传递编程模型, 并成为这种编程模型的代表和事实上的标准. MPI虽
然很庞大, 但是它的最终目的是服务于进程间通信这一目标的.

在MPI上很容易移植其它的并行代码, 而且编程者不需要去努力掌握许多其它的全新概
念, 就可以学习编写MPI程序. 当然, 这并不意味着MPI已经十分完美, 必须承认MPI自身
还存在着一些缺点. 在本书的后续章节将对它进行讨论.

消息传递方式是广泛应用于多类并行机的一种模式, 特别是那些分布存储并行机, 尽管
在具体的实现上有许多不同, 但通过消息完成进程通信的基本概念是容易理解的, 十多年
来, 这种模式在重要的计算应用中已取得了实质进步, 有效和可移植地实现一个消息传递系
统是可行的. 因此, 通过定义核心库程序的语法语义, 这将在大范围计算机上可有效实现
将有益于广大用户. 这是MPI产生的重要原因.

## MPI的目的

MPI为自己制定了一个雄心勃勃的目标, 总结概括起来, 它包括几个在实际使用中都十分重要但有时又是相互矛盾的三个方面 1.较高的通信性能; 2.较好的程序可移植性;3.强大的功能. 具体地说,包括以下几个方面: 
* 提供应用程序编程接口
* 提高通信效率 措施包括避免存储器到存储器的多次重复拷贝 允许计算和通信的
重叠等
* 可在异构环境下提供实现;
* 提供的接口可以方便 C 语言和 Fortran 77的调用;
* 提供可靠的通信接口 即用户不必处理通信失败;
* 定义的接口和现在已有接口 如PVM NX Express p4等 差别不能太大 但是
允许扩展以提供更大的灵活性;
* 定义的接口能在基本的通信和系统软件无重大改变时 在许多并行计算机生产商的
平台上实现 接口的语义是独立于语言的;
* 接口设计应是线程安全的;

MPI提供了一种与语言和平台无关, 可以被广泛使用的编写消息传递程序的标准, 用它
来编写消息传递程序, 不仅实用, 可移植, 高效和灵活, 而且和当前已有的实现没有太大的
变化.

## MPI的产生

许多组织对MPI标准付出了努力, 它们主要来自美国和欧洲, 大约有六十几个人, 分属四十几个不同的单位, 这包括了并行计算机的多数主要生产商, 还有来自大学, 政府实验室.
和工厂的研究人员.

有关的工作及其组织包括 Venus(IBM) NX/2 (Intel) Express (Parasoft) Vertex
(nCUBE) P4 (ANL) PARMACS (ANL) 还包括Zipcode (MSU) Chimp (Edinburgh
University)PVM (ORNL, UTK, Emory U.) Chameleon (ANL) PICL (ANL)等. 

MPI的标准化开始于一九九二年四月二十九日至三十日在威吉尼亚的威廉姆斯堡召开的
分布存储环境中消息传递标准的讨论会, 由Dongarra, Hempel, Hey和Walker建议的初始草案于
一九九二年十一月推出, 并在一九九三年二月完成了修订版. 这就是MPI 1.0. 为了促进MPI
的发展, 一个称为MPI论坛的非官方组织应运而生. 该论坛对MPI的发展起了重要的作用.
一九九五年六月推出了MPI的新版本MPI1.1, 对原来的MPI作了进一步的修改, 完善和
扩充. 但是当初推出MPI标准时, 为了能够使它尽快实现并迅速被接受, 许多其它方面的重
要但实现起来比较复杂的功能都没有定义, 比如并行I/O. 当MPI被广为接受之后, 扩充并
提高MPI功能的要求就越来越迫切了. 
于是在一九九七年的七月 在对原来的MPI作了重大扩充的基础上, 又推出了MPI的扩
充部分MPI-2, 而把原来的MPI各种版本称为MPI-1. MPI-2的扩充很多, 但主要是三个方面
并行I/O, 远程存储访问和动态进程管理. 本书的这一部分主要讲述MPI-1的内容, 对于
MPI-2, 将在最后做专门介绍.

## MPI的语言绑定

由于MPI是一个库而不是一门语言, 因此对MPI的使用必须和特定的语言结合起来进
行. FORTRAN是科学与工程计算的领域语言, 而C又是目前使用最广泛的系统和应用程序
开发的语言之一, 因此对FORTRAN和C的支持是必须的. 
因此在MPI-1中, 明确提出了MPI和FORTRAN77与C语言的绑定, 并且给出了通用接口
和针对FORTRAN77与C的专用接口说明. MPI-1的成功说明MPI选择的语言绑定策略是正确
和可行的.
Fortran90是FORTRAN的扩充, 它在表达数组运算方面有独特的优势, 还增加了模块等
现代语言的方便开发与使用的各种特征. 它目前面临的一个问题是Fortran90编译器远不如
FORTRAN77编译器那样随处可见, 但提供Fortran90编译器的厂商正在逐步增多. C++作为
面向对象的高级语言, 随着编译器效率和处理器速度的提高, 它可以取得接近于C的代码效
率. 面向对象的编程思想已经被广为接受. 因此在MPI-2中, 除了和原来的FORTRAN77和
C语言实现绑定之外, 进一步与Fortran90和C++结合起来, 提供了四种不同的接口, 为编程
者提供了更多选择的余地.

## 小结

本章的目的是给读者一个关于MPI的概貌, MPI的一个最重要的特点就是免费和源代码
开放, MPI可以被迅速接受和它为自己定下的高效率, 方便移植和功能强大三个主要目标密
不可分. 它采用广为使用的语言FORTRAN和C进行绑定, 也是它成功的一个重要因素. 当
然, MPI的成功, 还因为它总结和吸收了前期大量消息传递系统的经验. 一个成功的标准是
需要大量的实践和艰苦的努力的, MPI就是这种实践和努力的结果.
