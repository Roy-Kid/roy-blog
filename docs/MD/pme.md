---
title: 第二章- Ewald On A Grid
date: 2021-08-18
categories:
 - MD
tags:
 - FF
sidebar: 'auto'
---

有些体系中, 长程与短程作用力兼而有之, 短程作用力设定的截断距离也可以用在长程作用力的实空间计算上. 对于大体系来说, Ewald求和的傅里叶变换部分的时间复杂度在$O(N**2)$, 且只有倒空间的计算效率非常的低. 因此解决这一瓶颈可以极大地提高长程作用的计算速度. 有人就发现, 如果把这些电荷分布打散到网格上, 就会使泊松方程的求解变得非常有效率. 下面, 我们简要地介绍一下PME或者叫PPPM的思路. 

最早用于分子动力学模拟的PME方法是由Hockney和Eastwood提出的. 在网格上对系统中的电荷进行插值, 得到离散化的泊松方程, 而规则网格上的泊松方程可以非常好地用快速傅里叶变换的方法求解. 计算机求解快速傅里叶问题的复杂度是$O(NlogN)$. 直接将这种方法应用到计算中精确度不是很好, 所以受到Ewald的启发, 将长短程分离, 长程采用把电荷打散到网格上的做法, 短程作用力直接计算粒子相互作用. 

## 电荷分配

将电荷分配到网格上的过程很容易推导. 首先我们考虑一维的情况, 比如, 坐标在$[0, L] \in \mathbb{R}$的粒子需要分配到格点$x_p \in \mathbb{M}=\{ph: p=0,...,N_{M-1}\}$上. 其中, $N_M$是格点数量, $h:=L/N_M$是间隔(spacing). 简单起见, 我们默认在范围之外的粒子都可以折回到$x \in [0, L]$中, 满足周期性边界条件, 因此计算时有必要对坐标取模$L$.

定义一个偶函数$W(x)$, 使得在$x$处的点电荷分配到格点$x_p$处的电荷可以通过$W(x-x_p)$给出. 如果系统的电荷密度是$\rho(x)$, 定义基于格点计算的电荷密度是$\rho_M(x_p)$, 可以通过卷积计算:

$$
\rho_{\mathrm{M}}\left(x_{p}\right)=\frac{1}{h} \int_{0}^{L} \mathrm{~d} x W\left(x_{p}-x\right) \rho(x)
$$

前置因子$1/h$指出这是密度. 我们接下来称$W(x)$为*电荷分配函数*. 那么这个函数有什么样的性质呢, 或者说什么样的函数是我们想要的呢. 我们希望:

* 电荷守恒: 点电荷的电量必须等于打散到周围格点上的电量和;
* 范围尽可能小: 涉及到的格点越多, 计算量越大;
* 离散化的误差局部化: 两个粒子相互作用力由于离散而产生的误差, 应该随间距的增加而减小;
* 平滑度大: 分配给某个格点的电荷应该是粒子位置的平滑变化函数;
* 混叠误差最小化: 即, 在有限网格有限个K向量的空间中, 电荷分配函数应在倒易空间迅速衰减;
* 容易实现.

> 鱼与熊掌不可兼得. 我们还想强调的是, $W(x)$的选择并不独立于网格实现的其他决策. 在附录B中, 我们表明, 如果在网格计算中坚持连续库仑格林函数, 则离散误差局部化的要求足以将电荷分配限制在Lagrange插值中. 这实际上是用于PME的组合. 因此, 只有同时以某种方式调整库仑格林函数, 其他函数才能具有竞争力.

Hockney和Eastwood使用的电荷分配函数如下: 在$P^{th}$阶分配模式下(也就是说一个点电荷严佩岛周围最近的$P$个格点上), 经过傅里叶变换后的分配函数满足:

$$
\tilde{W}^{(P)}(k)=h\left(\frac{\sin (k h / 2)}{k h / 2}\right)^{P}
$$

变换回实空间则是: 

$$
W^{(P)}(x)=(\underbrace{\left.\chi_{\left[-\frac{1}{2}, \frac{1}{2}\right]} \star \cdots \star \chi_{\left[-\frac{1}{2}, \frac{1}{2}\right]}\right)}_{P \text {-fold convolution }})(x / h)
$$

其中, $\chi_{\left[-\frac{1}{2}, \frac{1}{2}\right]}$是间隔$\left[-\frac{1}{2}, \frac{1}{2}\right]$的特征函数, 满足在其中是1, 外面是0. 